(e=>{if(!e.WYSIWYG){let l={selector:".wysiwyg",height:300,placeholder:"Start typing...",sanitize:!0,toolbar:["bold","italic","underline","strike","|","ul","ol","indent","outdent","|","link","image","|","code","quote","|","toggleSource"],uploadUrl:null,uploadFieldName:"image",uploadHeaders:{},onUploadProgress:null,parseUploadResponse:e=>e&&(e.url||e.data&&e.data.url)||null,uploadHandler:null},d=`
.wysiwyg-wrapper{border:1px solid #d1d5db;border-radius:6px;background:#fff;font-family:inherit;color:#111}
.wysiwyg-toolbar{display:flex;flex-wrap:wrap;gap:6px;padding:6px;background:#fafafa;border-bottom:1px solid #e5e7eb}
.wysiwyg-toolbar button{background:transparent;border:1px solid #e5e7eb;padding:6px 8px;border-radius:6px;cursor:pointer}
.wysiwyg-editor{min-height:80px;padding:12px;outline:none;color:inherit}
.wysiwyg-editor img.uploading{opacity:0.7;filter:grayscale(30%);}
.wysiwyg-source{width:100%;box-sizing:border-box;padding:10px;border:none;font-family:monospace;min-height:100px}
.wysiwyg-hidden{display:none}
.wysiwyg-progress{height:4px;background:#e6e6e6;border-radius:4px;overflow:hidden;margin-top:6px}
.wysiwyg-progress > i{display:block;height:100%;width:0%;background:#3b82f6;border-radius:4px}
`;window.addEventListener("unload",()=>{try{document.querySelectorAll("img[data-_blob-url]").forEach(e=>{try{URL.revokeObjectURL(e.dataset._blobUrl)}catch(e){}}),document.querySelectorAll("img").forEach(e=>{if(e.dataset&&e.dataset._blobUrl)try{URL.revokeObjectURL(e.dataset._blobUrl)}catch(e){}})}catch(e){}}),e.WYSIWYG={init:function(e,t){e=e||l.selector;let r=[];return"string"==typeof e?r=Array.from(document.querySelectorAll(e)):e instanceof NodeList||Array.isArray(e)?r=Array.from(e):e instanceof HTMLTextAreaElement&&(r=[e]),r.map(e=>a(e,t))},sanitizeHtml:i};try{e.KriaLite||(e.KriaLite=e.WYSIWYG)}catch(e){}function i(e){for(var t=document.createElement("div"),r=(t.innerHTML=e,t.querySelectorAll("script,style,iframe,object,embed").forEach(e=>e.remove()),document.createTreeWalker(t,NodeFilter.SHOW_ELEMENT,null)),o=[];r.nextNode();)o.push(r.currentNode);return o.forEach(o=>{Array.from(o.attributes||[]).forEach(e=>{var t=e.name.toLowerCase(),r=(e.value||"").toLowerCase();(t.startsWith("on")||"href"===t&&r.startsWith("javascript:"))&&o.removeAttribute(e.name)})}),t.innerHTML}function o(e,t,r){t&&t.editorEl?("codeBlock"===e?document.execCommand("formatBlock",!1,"pre"):"formatBlock"===e&&r?document.execCommand("formatBlock",!1,r):document.execCommand(e,!1,r||null),m(t)):console.warn("WYSIWYG: editor not ready for command",e)}function s(e,n){let a=document.createElement("div"),r=(a.className="wysiwyg-toolbar",(e,t,r)=>{var o=document.createElement("button");return o.type="button",o.dataset.cmd=e,o.title=t,o.textContent=t,o.addEventListener("click",r),a.appendChild(o),o});return e.forEach(e=>{var t;if("|"===e)(t=document.createElement("div")).style.width="8px",a.appendChild(t);else switch(e){case"bold":r("bold","B",()=>o("bold",n));break;case"italic":r("italic","I",()=>o("italic",n));break;case"underline":r("underline","U",()=>o("underline",n));break;case"strike":r("strikeThrough","S",()=>o("strikeThrough",n));break;case"ul":r("insertUnorderedList","â€¢ List",()=>o("insertUnorderedList",n));break;case"ol":r("insertOrderedList","1. List",()=>o("insertOrderedList",n));break;case"indent":r("indent","Indent",()=>o("indent",n));break;case"outdent":r("outdent","Outdent",()=>o("outdent",n));break;case"link":r("link","Link",()=>{var e,t;(e=n)&&(t=prompt("Enter URL (include http:// or https://)"))&&o("createLink",e,t)});break;case"image":r("image","Image",()=>(async l=>{var e;l&&((e=document.createElement("input")).type="file",e.accept="image/*",e.addEventListener("change",async r=>{r=r.target.files&&r.target.files[0];if(r){let t=URL.createObjectURL(r),o=document.createElement("img");o.src=t,o.alt=r.name||"",o.style.maxWidth="100%",o.classList.add("uploading"),o.dataset._blobUrl=t,u(o,l.editorEl),m(l);(e=>{if(!e)return;let t=e.wrapper,r=t.querySelector(".wysiwyg-progress");var o;r||((r=document.createElement("div")).className="wysiwyg-progress",o=document.createElement("i"),r.appendChild(o),t.appendChild(r)),r.style.display="",c(e,0),r})(l);var a=e=>{if(e){o.src=e,o.removeAttribute("data-_blobUrl"),o.classList.remove("uploading");try{URL.revokeObjectURL(t)}catch(e){}}else o.classList.remove("uploading");p(l),m(l)};if("function"==typeof l.options.uploadHandler)try{var n=await l.options.uploadHandler(r,{onProgress:(e,t,r)=>{"function"==typeof l.options.onUploadProgress&&l.options.onUploadProgress(e,t,r,o,l),c(l,e)}});let e=null;n&&("string"==typeof n?e=n:"object"==typeof n&&(e=l.options.parseUploadResponse?l.options.parseUploadResponse(n):n.url||null)),a(e)}catch(e){console.error("Custom uploadHandler failed",e),alert("Image upload failed"),p(l)}else if(l.options.uploadUrl)try{var e=await((a,e={},n)=>{let i=e.uploadUrl,l=e.uploadFieldName||"image",d=e.uploadHeaders||{};return i?new Promise((t,r)=>{let o=new XMLHttpRequest;var e=new FormData;e.append(l,a,a.name),o.open("POST",i,!0),Object.keys(d).forEach(e=>{try{o.setRequestHeader(e,d[e])}catch(e){}}),o.upload.onprogress=e=>{var t;e.lengthComputable&&"function"==typeof n&&(t=Math.round(e.loaded/e.total*100),n(t,e.loaded,e.total))},o.onreadystatechange=()=>{if(4===o.readyState)if(200<=o.status&&o.status<300){let e=null;try{e=JSON.parse(o.responseText)}catch(e){return r(new Error("Invalid JSON from upload endpoint"))}t(e)}else r(new Error("Upload failed: "+o.status+" "+o.statusText))},o.onerror=()=>r(new Error("Network error during upload")),o.send(e)}):Promise.reject(new Error("uploadUrl not provided"))})(r,l.options,(e,t,r)=>{"function"==typeof l.options.onUploadProgress&&l.options.onUploadProgress(e,t,r,o,l),c(l,e)}),i="function"==typeof l.options.parseUploadResponse?l.options.parseUploadResponse(e):e&&(e.url||null);if(!i)return console.warn("Upload response did not contain an image URL",e),alert("Upload succeeded but response did not include image URL"),void a(null);a(i)}catch(e){console.error("Upload failed",e),alert("Image upload failed: "+(e&&e.message)),a(null)}else o.classList.remove("uploading"),p(l),m(l)}}),e.click())})(n));break;case"code":r("codeBlock","Code",()=>{var e,t,r,o,a;(e=n)&&e.editorEl&&((t=window.getSelection())&&t.rangeCount&&!t.isCollapsed?(t=t.getRangeAt(0),o=t.toString(),r=document.createElement("pre"),(a=document.createElement("code")).textContent=o,r.appendChild(a),t.deleteContents(),t.insertNode(r)):(o=document.createElement("pre"),(a=document.createElement("code")).textContent="\n// code\n",o.appendChild(a),u(o,e.editorEl)),m(e))});break;case"quote":r("quote","Quote",()=>o("formatBlock",n,"blockquote"));break;case"toggleSource":r("toggleSource","Source",()=>{var e,t,r,o,a;(e=n)&&({editorEl:t,sourceEl:r,options:a}=e,t)&&r&&(r.classList.contains("wysiwyg-hidden")?(r.value=t.innerHTML,t.classList.add("wysiwyg-hidden"),r.classList.remove("wysiwyg-hidden"),r):(o=r.value,a=a.sanitize?i(o):o,t.innerHTML=a,r.classList.add("wysiwyg-hidden"),t.classList.remove("wysiwyg-hidden"),m(e),t)).focus()});break;default:r(e,e,()=>o(e,n))}}),a}function c(e,t){e&&(e=e.wrapper.querySelector(".wysiwyg-progress"))&&(e.querySelector("i").style.width=Math.max(0,Math.min(100,t||0))+"%")}function p(t){if(t){let e=t.wrapper.querySelector(".wysiwyg-progress");e&&setTimeout(()=>{e.style.display="none",c(t,0)},300)}}function u(e,t){var r,o=window.getSelection();o&&o.rangeCount?((r=o.getRangeAt(0)).deleteContents(),r.insertNode(e),r.setStartAfter(e),r.setEndAfter(e),o.removeAllRanges(),o.addRange(r)):t.appendChild(e)}function m(e){var t,r;e&&({editorEl:e,textarea:t,options:r}=e,t)&&(t.value=r.sanitize?i(e&&e.innerHTML||""):e&&e.innerHTML||"")}function a(e,t){document.getElementById("wysiwyg-widget-styles")||((r=document.createElement("style")).id="wysiwyg-widget-styles",r.textContent=d,document.head.appendChild(r));var r=Object.assign({},l,t||{}),t=document.createElement("div"),o=(t.className="wysiwyg-wrapper",document.createElement("div")),a=(o.className="wysiwyg-editor",o.contentEditable=!0,o.style.minHeight=(r.height||200)+"px",o.innerHTML=e.value||"",document.createElement("textarea"));a.className="wysiwyg-source wysiwyg-hidden",a.style.minHeight=(r.height||200)+"px";let n={textarea:e,wrapper:t,editorEl:o,sourceEl:a,options:r};var i=s(r.toolbar,n),i=(t.appendChild(i),t.appendChild(o),t.appendChild(a),e.style.display="none",e.parentNode.insertBefore(t,e.nextSibling),o.addEventListener("input",()=>m(n)),a.addEventListener("input",()=>{}),e.addEventListener("change",()=>{var e;(e=n)&&(e.editorEl.innerHTML=e.textarea.value||"",e.sourceEl)&&!e.sourceEl.classList.contains("wysiwyg-hidden")&&(e.sourceEl.value=e.textarea.value||"")}),e.closest("form"));return i&&i.addEventListener("submit",()=>m(n)),e._wysiwyg=n}}})(window);